---
layout: post
title:  "MQTT"
date:   2021-06-01 15:27:56
categories: jekyll update
---

### MQTT协议

#### 概述
基于TCP/IP协议、TLS协议、Websocket协议等传输层协议实现的一种轻量级消息传输协议，因为其轻量级，易实现这些特点使得其在IOT领域是个很好的选择。

#### MQTT介绍
首先分为客户端（Client）和服务端（Server），也常说有发布者（publish），订阅者（subscribe），
代理者（broker）这三种区分。

**客户端**  
使用MQTT程序的程序或设备，通过网络连接到服务端  
  
* 发布应用消息给其它相关客户端。
* 订阅消息。
* 取消订阅。
* 从服务端断开连接。  

**服务端**  
相当于发送消息和请求订阅的客户端之间的一个中介，可以是程序或者设备。  
  
* 接受客户端的连接请求。
* 接受客户端发布的消息。
* 处理客户端的订阅和取消订阅要求。
* 转发应用消息给符合条件的已订阅客户端。  

**数据表示**
  
* 二进制
* 整数数值
* UTF-8编码字符串

#### MQTT控制报文格式

协议一般都是通过预先定义好的报文来进行通信，MQTT协议也是一样，就像一种暗号一样，对上了才能进行交流。
MQTT控制报文由三部分组成

##### 报文整体结构

|整体结构												  |
|:--:													 |
|Fixed header|  **固定报头，所有的控制报文都要包含的部分**|
|Variable header|可变报头，部分控制报文包含                 |
|Payload		|有效载荷，部分控制报文包含				   |

就是说固定报头是所有的MQTT控制报文里都要带有的部分，其它两个则是部分包含。

##### 固定报头 Fxied header

**固定报头的格式**  

<table>
    <tr>
        <td>Bit</td>
        <td >7</td> 
        <td>6</td> 
        <td>5</td> 
        <td>4</td> 
        <td>3</td> 
        <td>2</td> 
        <td>1</td> 
        <td>0</td> 
   </tr>
    <tr>
        <td>byte</td>    
        <td colspan = 4>MQTT控制报文类型</td>  
        <td colspan = 4>用于指定控制报文类型的标志位</td>
    </tr>
    <tr>
        <td >byte2...</td>
        <td colspan = 8 align = center>剩余长度</td>   
    </tr>
</table>

也就是说其实固定报头真正的部分就是报文的第一个字节。



































